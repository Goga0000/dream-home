document.addEventListener("DOMContentLoaded",()=>{window.swiperInstance=new Swiper(".swiper",{loop:!1,autoplay:!1,freeMode:!0,slidesPerView:"auto",spaceBetween:8});const e="sdfkj343jhsdfkhfgd";let t=null,n=[],r=null;const o=()=>{n.forEach(e=>e.setMap(null)),n=[]},i=(e=null,s=!1)=>{r=e,n.forEach((n,o)=>{n.content.style.border=o===e?"3px solid #4C4DDC":"3px solid white";const i=document.querySelectorAll(".maps-item:not([hidden])")[o];i&&i.classList.toggle("active-slide",o===e)}),document.querySelectorAll(".swiper-slide").forEach((n,o)=>n.classList.toggle("active-slide",o===e)),s&&window.swiperInstance?.slideTo&&null!==e&&window.swiperInstance.slideTo(e)},a=()=>{if(!t)return;o();const e=document.querySelectorAll(".maps-item:not([hidden])");if(!e.length)return;const s=new google.maps.LatLngBounds;e.forEach((o,a)=>{const l=parseFloat(o.dataset.lat),d=parseFloat(o.dataset.lng),c=o.dataset.img||"",m=o.querySelector("h3")?.innerText||"Объект";s.extend({lat:l,lng:d});const u=document.createElement("div");u.className="custom-marker",Object.assign(u.style,{width:"48px",height:"48px",border:"3px solid white",borderRadius:"50%",overflow:"hidden",background:"#fff",boxShadow:"0 2px 8px rgba(76,77,220,0.16)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border 0.2s"});const f=document.createElement("img");f.src=c,f.alt=m,Object.assign(f.style,{width:"100%",height:"100%",objectFit:"cover"}),u.appendChild(f);const v=new google.maps.marker.AdvancedMarkerElement({map:t,position:{lat:l,lng:d},content:u,title:m});v.addListener("gmp-click",()=>i(a,!0)),n.push(v)}),e.length>1?t.fitBounds(s,80):(t.setCenter({lat:parseFloat(e[0].dataset.lat),lng:parseFloat(e[0].dataset.lng)}),t.setZoom(13)),i(null)},c=()=>{const e=document.querySelectorAll("[data-price]");if(!e.length)return;const t=Array.from(e).map(e=>Number(e.getAttribute("data-price").replace(/\s/g,""))).filter(e=>!isNaN(e));if(!t.length)return;const n=Math.min(...t),r=Math.max(...t),o=20,l=document.querySelectorAll(".bar-item[data-bar]");if(!l.length)return;const d=(r-n)/o,a=new Array(o).fill(0);t.forEach(t=>{let n=Math.floor((t-n)/d);n===o&&(n=o-1),a[n]++});const s=Math.max(...a),c=(e,t,d=500)=>{e.style.transition=`height ${d}ms ease-in-out`,e.style.height=t+"%"};l.forEach((e,t)=>{const n=Number(e.getAttribute("data-bar"))-1,r=s?a[n]/s*100:0;c(e,r,800)})},m=(e=20)=>{const s=document.getElementById("custom-map"),l=document.querySelector(".maps-item:not([hidden])");if(!s||!l||0===s.offsetHeight){if(e>0)return void setTimeout(()=>m(e-1),300);return}t=new google.maps.Map(s,{zoom:11,center:{lat:parseFloat(l.dataset.lat),lng:parseFloat(l.dataset.lng)},mapId:e,disableDefaultUI:!0}),t.addListener("click",()=>i(null)),a()},window.initMap=()=>m(),document.addEventListener("DOMContentLoaded",()=>{window.swiperInstance.on("slideChange",()=>{i(window.swiperInstance.activeIndex,!1)});const e=()=>{t&&a(),window.swiperInstance&&window.swiperInstance.update(),i(null)};document.addEventListener("fs-cmsfilter-update",e),document.getElementById("btts-load")?.addEventListener("click",()=>setTimeout(e,400)),document.querySelector('[fs-list-element="clear"]')?.addEventListener("click",()=>setTimeout(e,400)),document.addEventListener("click",t=>{t.target.closest('[fs-list-element="tag-remove"]')&&setTimeout(e,400)});const n=document.getElementById("search-filter");if(n){let t;const r=()=>{clearTimeout(t),t=setTimeout(()=>setTimeout(e,100),200)};n.addEventListener("input",r)}})});
