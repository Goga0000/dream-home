document.addEventListener("DOMContentLoaded",()=>{window.swiperInstance=new Swiper(".swiper",{loop:!1,autoplay:!1,slidesPerView:"auto",centeredSlides:!0});let e=null,t=null,l=new Map,a=(t,l)=>{let a=parseFloat(t.dataset.lat),s=parseFloat(t.dataset.lng),i=t.dataset.img||"",r=t.querySelector("h3")?.innerText||"Объект",d=document.createElement("div");d.className="custom-marker",Object.assign(d.style,{width:"48px",height:"48px",border:"3px solid white",borderRadius:"50%",overflow:"hidden",background:"#fff",boxShadow:"0 2px 8px rgba(76,77,220,0.16)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border 0.2s"});let o=document.createElement("img");o.src=i,o.alt=r,Object.assign(o.style,{width:"100%",height:"100%",objectFit:"cover"}),d.appendChild(o);let c=new google.maps.marker.AdvancedMarkerElement({map:e,position:{lat:a,lng:s},content:d,title:r});return c.addListener("gmp-click",()=>n(l,!0)),{marker:c,content:d}},n=(e=null,a=!1)=>{t=e,l.forEach(({content:t},l)=>{t.style.border=l===e?"3px solid #4C4DDC":"3px solid white";let a=document.querySelectorAll(".maps-item:not([hidden])")[l];a&&a.classList.toggle("active-slide",l===e)}),document.querySelectorAll(".swiper-slide").forEach((t,l)=>t.classList.toggle("active-slide",l===e)),a&&window.swiperInstance?.slideTo&&null!==e&&window.swiperInstance.slideTo(e)},s=()=>{if(!e)return;let t=Array.from(document.querySelectorAll(".maps-item:not([hidden])"));if(!t.length){l.forEach(({marker:e})=>e.setMap(null)),l.clear();return}let s=new google.maps.LatLngBounds,i=new Map;if(t.forEach((e,t)=>{if(s.extend({lat:parseFloat(e.dataset.lat),lng:parseFloat(e.dataset.lng)}),l.has(t)){let n=l.get(t);i.set(t,n),l.delete(t)}else{let r=a(e,t);i.set(t,r)}}),l.forEach(({marker:e})=>e.setMap(null)),(l=i).forEach(({marker:t})=>t.setMap(e)),t.length>1)e.fitBounds(s,80);else{let r=parseFloat(t[0].dataset.lat),d=parseFloat(t[0].dataset.lng);e.setCenter({lat:r,lng:d}),e.setZoom(13)}n(null)},i=()=>{let e=document.querySelectorAll("[data-price]");if(!e.length)return;let t=Array.from(e).map(e=>Number(e.getAttribute("data-price").replace(/\s/g,""))).filter(e=>!isNaN(e));if(!t.length)return;let l=Math.min(...t),a=Math.max(...t),n=document.querySelectorAll(".bar-item[data-bar]");if(!n.length)return;let s=(a-l)/20,i=Array(20).fill(0);t.forEach(e=>{let t=Math.floor((e-l)/s);20===t&&(t=19),i[t]++});let r=Math.max(...i),d=(e,t,l=500)=>{e.style.transition=`height ${l}ms ease-in-out`,e.style.height=`${t}%`};n.forEach(e=>{let t=Number(e.getAttribute("data-bar"))-1,l=r?i[t]/r*100:0;d(e,l,800)})},r=(t=20)=>{let l=document.getElementById("custom-map"),a=document.querySelector(".maps-item:not([hidden])");if(!l||!a||0===l.offsetHeight){t>0&&setTimeout(()=>r(t-1),300);return}(e=new google.maps.Map(l,{zoom:11,center:{lat:parseFloat(a.dataset.lat),lng:parseFloat(a.dataset.lng)},mapId:"sdfkj343jhsdfkhfgd",disableDefaultUI:!0})).addListener("click",()=>n(null)),i()};window.initMap=()=>{r(),setTimeout(()=>{s()},1e3)};let d=()=>{e&&s()};document.addEventListener("fs-cmsfilter-update",d),document.addEventListener("DOMContentLoaded",d),window.swiperInstance.on("slideChange",()=>{n(window.swiperInstance.activeIndex,!1)});let o=()=>{if(e&&s(),window.swiperInstance){window.swiperInstance.update();let t=window.swiperInstance,l=t.slides.length;t.activeIndex>=l&&t.slideTo(l-1,0)}n(null)};document.addEventListener("fs-cmsfilter-update",o),document.getElementById("btts-load")?.addEventListener("click",()=>setTimeout(o,400)),document.querySelector('[fs-list-element="clear"]')?.addEventListener("click",()=>setTimeout(o,400)),document.addEventListener("click",e=>{e.target.closest('[fs-list-element="tag-remove"]')&&setTimeout(o,400)});let c=document.getElementById("search-filter");if(c){let p;c.addEventListener("input",()=>{clearTimeout(p),p=setTimeout(()=>{setTimeout(o,100)},200)})}});
