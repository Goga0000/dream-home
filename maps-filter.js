document.addEventListener("DOMContentLoaded",()=>{(()=>{const e=new URLSearchParams(window.location.search);if(e.get("open_modal")==="1"){const t=document.querySelector(".filter-modal-wrapper"),n=document.querySelector(".filter-modal");t&&(t.style.display="flex"),n&&n.removeAttribute("style")}})(),window.swiperInstance=new Swiper(".swiper",{loop:false,autoplay:false,freeMode:true,slidesPerView:"auto",spaceBetween:8});const MAP_ID="sdfkj343jhsdfkhfgd";let map,markers=[],activeMarkerIndex=null;const clearMarkers=()=>{markers.forEach(e=>e.setMap(null)),markers=[]},setActiveMarker=(e=null,t=!1)=>{activeMarkerIndex=e,markers.forEach((n,o)=>{n.content.style.border=o===e?"3px solid #4C4DDC":"3px solid white";const r=document.querySelectorAll(".maps-item:not([hidden])")[o];r&&r.classList.toggle("active-slide",o===e)}),document.querySelectorAll(".swiper-slide").forEach((n,o)=>n.classList.toggle("active-slide",o===e)),t&&window.swiperInstance?.slideTo&&null!==e&&window.swiperInstance.slideTo(e)},updateMarkers=()=>{if(!map)return;clearMarkers();const e=document.querySelectorAll(".maps-item:not([hidden])");if(!e.length)return;const t=new google.maps.LatLngBounds;return e.forEach((n,o)=>{const r=parseFloat(n.dataset.lat),i=parseFloat(n.dataset.lng),a=n.dataset.img||"",l=n.querySelector("h3")?.innerText||"Объект";t.extend({lat:r,lng:i});const c=document.createElement("div");c.className="custom-marker",Object.assign(c.style,{width:"48px",height:"48px",border:"3px solid white",borderRadius:"50%",overflow:"hidden",background:"#fff",boxShadow:"0 2px 8px rgba(76,77,220,0.16)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border 0.2s"});const d=document.createElement("img");d.src=a,d.alt=l,Object.assign(d.style,{width:"100%",height:"100%",objectFit:"cover"}),c.appendChild(d);const u=new google.maps.marker.AdvancedMarkerElement({map,position:{lat:r,lng:i},content:c,title:l});u.addListener("gmp-click",()=>setActiveMarker(o,!0)),markers.push(u)}),e.length>1?map.fitBounds(t,80):(map.setCenter({lat:parseFloat(e[0].dataset.lat),lng:parseFloat(e[0].dataset.lng)}),map.setZoom(13)),setActiveMarker(null)},animateBarGraph=()=>{const e=document.querySelectorAll("[data-price]");if(!e.length)return;const t=Array.from(e).map(e=>Number(e.getAttribute("data-price").replace(/\s/g,""))).filter(e=>!isNaN(e));if(!t.length)return;const n=Math.min(...t),r=Math.max(...t),i=20,o=document.querySelectorAll(".bar-item[data-bar]");if(!o.length)return;const s=(r-n)/i,a=new Array(i).fill(0);t.forEach(t=>{let r=Math.floor((t-n)/s);r===i&&(r=i-1),a[r]++});const l=Math.max(...a),c=(e,t,d=500)=>{e.style.transition=`height ${d}ms ease-in-out`,e.style.height=t+"%"};o.forEach((e,t)=>{const n=Number(e.getAttribute("data-bar"))-1,r=l?a[n]/l*100:0;c(e,r,800)})},waitForMapInit=(e=20)=>{const t=document.getElementById("custom-map"),n=document.querySelector(".maps-item:not([hidden])");if(!t||!n||0===t.offsetHeight){if(e>0)return void setTimeout(()=>waitForMapInit(e-1),300);return}map=new google.maps.Map(t,{zoom:11,center:{lat:parseFloat(n.dataset.lat),lng:parseFloat(n.dataset.lng)},mapId:MAP_ID,disableDefaultUI:!0}),map.addListener("click",()=>setActiveMarker(null)),updateMarkers(),animateBarGraph()},window.initMap=()=>waitForMapInit(),document.addEventListener("DOMContentLoaded",()=>{window.swiperInstance.on("slideChange",()=>{setActiveMarker(window.swiperInstance.activeIndex,!1)});const e=()=>{map&&updateMarkers(),window.swiperInstance&&window.swiperInstance.update(),setActiveMarker(null)};document.addEventListener("fs-cmsfilter-update",e),document.getElementById("btts-load")?.addEventListener("click",()=>setTimeout(e,400)),document.querySelector('[fs-list-element="clear"]')?.addEventListener("click",()=>setTimeout(e,400)),document.addEventListener("click",t=>{t.target.closest('[fs-list-element="tag-remove"]')&&setTimeout(e,400)});const t=document.getElementById("search-filter");if(t){let n;const r=()=>{clearTimeout(n),n=setTimeout(()=>setTimeout(e,100),200)};t.addEventListener("input",r)}})});
